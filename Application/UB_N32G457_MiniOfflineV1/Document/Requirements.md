# 功能清单


## 时间计时
使用 TIM 进行计时，每 100 ms 计时一次，在充电开始时启动计时，充电完成后结束计时

## 采集电压
1. 从 IM153E 获取电压数据，采集频率 1条/200 ms
2. 电压精度为 0.1V
3. 波特率为 4800bps, 8,N,1
4. Modbus RTU 协议, 发送 01 03 00 48 00 08 C4 1A 读取数据，如果只需要电压，可以调整该指令

## 采集电流
1. 从 CHCS-CAB-500A 采集电流，采集频率 10条/100 ms
2. 电流精度为 0.001A

## 上报电能计量
1. 直流电表数据按协议上报

## 采集 CAN 数据
1. 采集CAN数据
2. 过滤重复的数据
3. 组包上报数据

## 上报心跳

1. 没有充电过程时，按照协议上报心跳数据

## 设备状态机

1. 维护设备当前状态: 
   - 设备启动中
   - 启动网络中
   - 网络启动完成
   - 设备就绪/闲置中
   - 充电开始
   - 充电结束
   - CAN数据采集中
   - 数据发送中
2. 维护当前的系统时间
   - 由 RTC 时间定时获取任务负责时间的获取

## 检测口通讯

1. 接收数据获取的命令，并返回当前的电压、电流、电能值

## OLED显示任务

1. 显示系统状态

## RTC时间定时获取

1. 每秒更新一次缓存的 RTC 时间

## 异步发送任务

1. 接收MQTT发送任务，并在空闲时进行发送；

## 按键控制

## CPUID 读取




# 硬件驱动清单

## 调试终端

> 用于调试和接收配置命令
>
> 使用 USART1, A9/A10, 115200, 8, N, 1

## A7670C 4G网络

> 4G 网络通讯
>
> - NTP 对时
> - MQTT 数据通讯

## W25Q128 外部存储
> 存储 CONFIG 信息

## OLED 0.96 屏
> 显示充电过程的电压、电流、功率
> 充电结束时显示本次充电的电能值

## KEY 按键
> 紧急情况下按下该按键，切断 CC1 通讯，停止充电

## DS1307 RTC
> - 硬件时钟
> - 保存累计电能数据

##  LED状态灯

1. 红灯
   - 出现网络故障时闪烁
   - 断掉CC1时常亮
2. 绿灯
   - 开机时无显示
   - 网络连接完成后常亮
   - 网络传输时闪烁



##  SHT3x 温湿度传感器

1. 获取温度、湿度数据
2. 支持两路温湿度传感器数据获取，I2C 接口
